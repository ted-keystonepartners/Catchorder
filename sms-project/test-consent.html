<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consent System Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 40px; 
            line-height: 1.6;
        }
        .test-result { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background: #f97316;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #ea580c; }
        .link-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: monospace;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Consent System Test</h1>
    <div class="test-result info">
        ì´ í…ŒìŠ¤íŠ¸ëŠ” ë™ì˜ì„œ ì‹œìŠ¤í…œì˜ ì£¼ìš” ê¸°ëŠ¥ë“¤ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    </div>

    <h2>1. ë§í¬ ìƒì„± í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testCreateLink()">ë™ì˜ì„œ ë§í¬ ìƒì„±</button>
    <div id="linkResult"></div>

    <h2>2. í¼ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testGetForm()">ë™ì˜ì„œ í¼ ì¡°íšŒ</button>
    <div id="formResult"></div>

    <h2>3. ë™ì˜ì„œ ì œì¶œ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testSubmitForm()">ë™ì˜ì„œ ì œì¶œ</button>
    <div id="submitResult"></div>

    <h2>4. ì œì¶œ í˜„í™© ì¡°íšŒ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testGetResponses()">ì œì¶œ í˜„í™© ì¡°íšŒ</button>
    <div id="responsesResult"></div>

    <h2>5. í´ë¦½ë³´ë“œ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testClipboard()">í´ë¦½ë³´ë“œ ë³µì‚¬</button>
    <div id="clipboardResult"></div>

    <script>
        // Mock í™˜ê²½ ì„¤ì •
        window.location = { origin: 'http://localhost:5173' };
        
        // ê°„ë‹¨í•œ fetch mock (ì‹¤ì œ APIëŠ” ì—†ìœ¼ë¯€ë¡œ)
        const originalFetch = window.fetch;
        window.fetch = async (url, options) => {
            console.log('Mock fetch called:', url, options);
            // ì‹¤íŒ¨ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜ (mock ë°ì´í„° ì‚¬ìš©í•˜ë„ë¡)
            throw new Error('API not implemented - using mock data');
        };

        // Mock ë™ì˜ì„œ API í•¨ìˆ˜ë“¤
        const mockCreateConsentLink = async (storeId) => {
            await new Promise(resolve => setTimeout(resolve, 500)); // ì§€ì—° ì‹œë®¬ë ˆì´ì…˜
            return {
                link_id: `link_${Date.now()}`,
                token: `mock_token_${Math.random().toString(36).substr(2, 9)}`,
                consent_url: `${window.location.origin}/consent/mock_token_${Math.random().toString(36).substr(2, 9)}`,
                expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                message: "ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ê³ ê°ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”"
            };
        };

        const mockGetConsentForm = async (token) => {
            await new Promise(resolve => setTimeout(resolve, 300));
            return {
                link_id: `link_${Date.now()}`,
                token: token,
                store_name: "í…ŒìŠ¤íŠ¸ ë§¤ì¥",
                store_phone: "02-1234-5678", 
                owner_name: "ê¹€ì˜ì—…",
                form_fields: {
                    respondent_name: "",
                    respondent_phone: "",
                    respondent_position: "",
                    agreement: false,
                    desired_install_date: "",
                    note: ""
                }
            };
        };

        const mockSubmitConsentForm = async (token, formData) => {
            await new Promise(resolve => setTimeout(resolve, 1000));
            return {
                response_id: `response_${Date.now()}`,
                submitted_at: new Date().toISOString()
            };
        };

        const mockGetConsentResponses = async (storeId) => {
            await new Promise(resolve => setTimeout(resolve, 400));
            return {
                responses: [
                    {
                        response_id: "resp_001",
                        respondent_name: "ê¹€ë™ì˜",
                        respondent_phone: "010-1234-5678",
                        respondent_position: "ì‚¬ì¥",
                        agreement: true,
                        desired_install_date: "2025-12-01",
                        note: "ì£¼ë§ ì˜¤ì „ ì„¤ì¹˜ í¬ë§í•©ë‹ˆë‹¤.",
                        submitted_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ],
                total_count: 1,
                link_info: {
                    created_at: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    expires_at: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString(),
                    is_active: true
                }
            };
        };

        // í´ë¦½ë³´ë“œ mock
        const mockCopyToClipboard = async (text) => {
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(text);
                return true;
            }
            // ì‹œë®¬ë ˆì´ì…˜
            console.log('Copied to clipboard:', text);
            return true;
        };

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        async function testCreateLink() {
            const resultDiv = document.getElementById('linkResult');
            resultDiv.innerHTML = '<div class="test-result info">ë§í¬ ìƒì„± ì¤‘...</div>';
            
            try {
                const result = await mockCreateConsentLink('test_store_123');
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… ë§í¬ ìƒì„± ì„±ê³µ!
                        <div class="link-box">
                            <strong>ë§í¬ URL:</strong><br>
                            ${result.consent_url}<br><br>
                            <strong>í† í°:</strong> ${result.token}<br>
                            <strong>ë§Œë£Œì¼:</strong> ${new Date(result.expires_at).toLocaleDateString('ko-KR')}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ ${error.message}</div>`;
            }
        }

        async function testGetForm() {
            const resultDiv = document.getElementById('formResult');
            resultDiv.innerHTML = '<div class="test-result info">í¼ ë°ì´í„° ì¡°íšŒ ì¤‘...</div>';
            
            try {
                const result = await mockGetConsentForm('mock_token_test123');
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… í¼ ë°ì´í„° ì¡°íšŒ ì„±ê³µ!
                        <div class="link-box">
                            <strong>ë§¤ì¥ëª…:</strong> ${result.store_name}<br>
                            <strong>ë§¤ì¥ ì „í™”:</strong> ${result.store_phone}<br>
                            <strong>ëŒ€í‘œì:</strong> ${result.owner_name}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ ${error.message}</div>`;
            }
        }

        async function testSubmitForm() {
            const resultDiv = document.getElementById('submitResult');
            resultDiv.innerHTML = '<div class="test-result info">ë™ì˜ì„œ ì œì¶œ ì¤‘...</div>';
            
            try {
                const formData = {
                    respondent_name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                    respondent_phone: '010-1234-5678',
                    respondent_position: 'ì‚¬ì¥',
                    agreement: true,
                    desired_install_date: '2025-12-01',
                    note: 'í…ŒìŠ¤íŠ¸ ì œì¶œì…ë‹ˆë‹¤.'
                };
                
                const result = await mockSubmitConsentForm('mock_token_test123', formData);
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… ë™ì˜ì„œ ì œì¶œ ì„±ê³µ!
                        <div class="link-box">
                            <strong>ì‘ë‹µ ID:</strong> ${result.response_id}<br>
                            <strong>ì œì¶œ ì‹œê°„:</strong> ${new Date(result.submitted_at).toLocaleString('ko-KR')}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ ${error.message}</div>`;
            }
        }

        async function testGetResponses() {
            const resultDiv = document.getElementById('responsesResult');
            resultDiv.innerHTML = '<div class="test-result info">ì œì¶œ í˜„í™© ì¡°íšŒ ì¤‘...</div>';
            
            try {
                const result = await mockGetConsentResponses('test_store_123');
                const responsesHtml = result.responses.map(resp => `
                    <div style="margin: 8px 0; padding: 8px; background: white; border-radius: 4px;">
                        <strong>${resp.respondent_name}</strong> (${resp.respondent_position})<br>
                        ğŸ“ ${resp.respondent_phone}<br>
                        ğŸ“… í¬ë§ì¼: ${resp.desired_install_date}<br>
                        ğŸ’­ ${resp.note || 'ì¶”ê°€ ì‚¬í•­ ì—†ìŒ'}
                    </div>
                `).join('');
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        âœ… ì œì¶œ í˜„í™© ì¡°íšŒ ì„±ê³µ!
                        <div class="link-box">
                            <strong>ì´ ì‘ë‹µ ìˆ˜:</strong> ${result.total_count}ê°œ<br>
                            ${responsesHtml}
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ ${error.message}</div>`;
            }
        }

        async function testClipboard() {
            const resultDiv = document.getElementById('clipboardResult');
            resultDiv.innerHTML = '<div class="test-result info">í´ë¦½ë³´ë“œ í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            try {
                const testUrl = 'http://localhost:5173/consent/mock_token_abc123';
                const success = await mockCopyToClipboard(testUrl);
                
                if (success) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… í´ë¦½ë³´ë“œ ë³µì‚¬ ì„±ê³µ!
                            <div class="link-box">
                                ë³µì‚¬ëœ URL: ${testUrl}
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ ${error.message}</div>`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = () => {
            console.log('ğŸ§ª Consent System Test Page Loaded');
            console.log('Mock í•¨ìˆ˜ë“¤ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        };
    </script>
</body>
</html>